<?php 

define ( 'APPLICATION_PATH' , realpath ( dirname ( __FILE__ ) ) ) ;

if ( isset ( $argc ) ) {
	define('VERBOSE',in_array("-v", $argv));
	define('RECURSIVE',in_array("-r", $argv));
	define('AUTO_CLEAR',in_array("-c", $argv));
	define ('IGNORE_EMPTY_EXTENSION' , isset(getopt(null,["ignore-empty-extension"])['ignore-empty-extension']) ) ;
}

/**
 * force output to be an array
 */
function getInArray( $value ) {
	if ( empty ( $value ) ) return [] ;
	if ( gettype ( $value ) === "array" ) return $value ;
	return [$value] ;
}

// file directory list
$_GLOBALS['INPUT_DIR_LIST'] = [];
if ( $dirList = getopt( "d:" , ["dir:"] ) ) {
	if ( !empty ( $dirList['d'] ) )   $_GLOBALS['INPUT_DIR_LIST'] = array_merge($_GLOBALS['INPUT_DIR_LIST'], getInArray($dirList['d'])   );
	if ( !empty ( $dirList['dir'] ) ) $_GLOBALS['INPUT_DIR_LIST'] = array_merge($_GLOBALS['INPUT_DIR_LIST'], getInArray($dirList['dir']) );
}

// MALWARE SOURCES
$_GLOBALS['MALWARE_SOURCES'] = [];
if ( $dirList = getopt( "s:" , ["malware-source:"] ) ) {
	if ( !empty ( $dirList['s'] ) )   $_GLOBALS['MALWARE_SOURCES'] = array_merge($_GLOBALS['MALWARE_SOURCES'], getInArray($dirList['s'])   );
	if ( !empty ( $dirList['malware-source'] ) ) $_GLOBALS['MALWARE_SOURCES'] = array_merge($_GLOBALS['MALWARE_SOURCES'], getInArray($dirList['malware-source']) );
}

// FILE TO LOG
$_GLOBALS['LOG_PATH'] = APPLICATION_PATH ;
if ( $dirList = getopt( null , ["log:"] ) ) {
	if ( is_array ( $dirList['log'] ) ) {
		$_GLOBALS['LOG_PATH'] = array_pop ( $dirList['log'] ) ;
	} else {
		$_GLOBALS['LOG_PATH'] = $dirList['log'] ;
	}
}

// FILE WITH LIST OF FILES TO BE SCANNED
$_GLOBALS['LIST_FILE'] = "" ;
if ( $dirList = getopt( null , ["list-file:"] ) ) {
	if ( is_array ( $dirList['list-file'] ) ) {
		$_GLOBALS['LIST_FILE'] = array_pop ( $dirList['list-file'] ) ;
	} else {
		$_GLOBALS['LIST_FILE'] = $dirList['list-file'] ;
	}
}

// ADMIN E-MAIL
$_GLOBALS['ADMIN_EMAIL'] = [];
if ( $dirList = getopt( "m:" , ["mail:"] ) ) {
	if ( !empty ( $dirList['m'] ) )   $_GLOBALS['ADMIN_EMAIL'] = array_merge($_GLOBALS['ADMIN_EMAIL'], getInArray($dirList['m'])   );
	if ( !empty ( $dirList['mail'] ) ) $_GLOBALS['ADMIN_EMAIL'] = array_merge($_GLOBALS['ADMIN_EMAIL'], getInArray($dirList['mail']) );
}

// FILE TYPES TO SCAN
$_GLOBALS['FILE_TYPE_SCAN'] = [];
if ( $dirList = getopt( "t:" , ["type:"] ) ) {
	if ( !empty ( $dirList['t'] ) )   $_GLOBALS['FILE_TYPE_SCAN'] = array_merge($_GLOBALS['FILE_TYPE_SCAN'], getInArray($dirList['t'])   );
	if ( !empty ( $dirList['type'] ) ) $_GLOBALS['FILE_TYPE_SCAN'] = array_merge($_GLOBALS['FILE_TYPE_SCAN'], getInArray($dirList['type']) );
}

// FILE TYPES TO IGNORE
$_GLOBALS['FILE_TYPE_IGNORE'] = [];
if ( $dirList = getopt( "i:" , ["ignore:"] ) ) {
	if ( !empty ( $dirList['i'] ) )   $_GLOBALS['FILE_TYPE_IGNORE'] = array_merge($_GLOBALS['FILE_TYPE_IGNORE'], getInArray($dirList['i'])   );
	if ( !empty ( $dirList['ignore'] ) ) $_GLOBALS['FILE_TYPE_IGNORE'] = array_merge($_GLOBALS['FILE_TYPE_IGNORE'], getInArray($dirList['ignore']) );
}

unset($dirList);

?>