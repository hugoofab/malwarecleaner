<?php 

require_once "config.php" ;
require_once "FileScanner.php" ;
require_once "Cleaner.php" ;


function println ( $msg , $force = false ) {
	if ( !$force && VERBOSE === false ) return;
	print( $msg . "\n" ) ;
}

// if no input dir, print help and exit;
if ( empty ( $_GLOBALS['INPUT_DIR_LIST'] ) && empty ( $_GLOBALS['LIST_FILE'] ) ) die ( file_get_contents ( APPLICATION_PATH . "/help.txt" ) );
if ( !is_writable ( $_GLOBALS['LOG_PATH'] ) ) die ("Log dir is not writeable");

println ("Starting Scanner");


$objFileScanner = new FileScanner ( $_GLOBALS['INPUT_DIR_LIST'] );

$objFileScanner->setAdminEmail ( $_GLOBALS['ADMIN_EMAIL'] ) ;
$objFileScanner->setMalwareDirList ( $_GLOBALS['MALWARE_SOURCES'] ) ;
$objFileScanner->setLogPath ( $_GLOBALS['LOG_PATH'] ) ;
$objFileScanner->setAutoClear ( AUTO_CLEAR ) ;
$objFileScanner->setRecursive ( RECURSIVE ) ;
$objFileScanner->setFileTypesToScan ( $_GLOBALS['FILE_TYPE_SCAN'] ) ;
$objFileScanner->setFileTypesToIgnore ( $_GLOBALS['FILE_TYPE_IGNORE'] ) ;

var_dump($_GLOBALS['LIST_FILE']);

if ( !empty ( $_GLOBALS['LIST_FILE'] ) ) {
	$objFileScanner->scanFileList($_GLOBALS['LIST_FILE']);
} else if ( !empty ( $_GLOBALS['INPUT_DIR_LIST'] ) ) {
	foreach ( $_GLOBALS['INPUT_DIR_LIST'] as $dir ) {
		$objFileScanner->scanDir($dir);
	}
}

// var_dump(getDirContents('/xampp/htdocs/WORK'));


?>